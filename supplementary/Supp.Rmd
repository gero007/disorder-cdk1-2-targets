---
title: "Supp 6"
output:
  html_document:
    df_print: paged
    fig_caption: yes
  pdf_document: default
---
  

```{r load data ,echo=FALSE,message=FALSE,warning=FALSE}
load("~/projects/cdk1_cyclinB1/phase_separation/disorder/disoWS.RData")

```

```{r setup,echo=FALSE,message=FALSE,warning=FALSE,prompt=FALSE}
library(jsonlite)
library(readr)
library(ggplot2)
library(GGally)
library(vcd)
library(kableExtra)
library(ggpubr)
library(Rcpi)
library(Biostrings)
library(eulerr)

#################################
########### FUCNTIONS ###########
#################################

#__________Spot disorder__________


getSpotDisoMatrix <- function(disoPath){ 
  output_list <- list()
  for (disoFile in dir(path = disoPath,pattern = "*.spotd")) {
    id=strsplit(disoFile,split = "\\.")[[1]][1]
    # print(id)
    # print(paste(disoPath,disoFile,sep = ""))
    auxdf <- read.delim(paste(disoPath,disoFile,sep = ""), header=FALSE, comment.char="#")
    disoRunningLenghts <- rle(as.vector(auxdf$V4))
    start=1
    disoMatrix <- matrix(ncol = 4,nrow = length(disoRunningLenghts$lengths))
    for (i in 1:length(disoRunningLenghts$lengths)) {
      end=start+disoRunningLenghts$lengths[i]-1
      disoMatrix[i,] <- as.character(c(start,end,disoRunningLenghts$values[i],disoRunningLenghts$lengths[i]))
      # print(c(start,end,test$values[i],test$lengths[i]))
      start=end+1
    }
    output_list[[id]] <- disoMatrix
  }
  # print(disoMatrix)
  # print(which(targetDf$acc==id))
  return(output_list)
}
#__________other functions__________

# yeastDiso is a complex database from MobiDB Saccharomyces cerevisiae. 

#################################
############# DATA ##############
#################################

yeastDiso<-stream_in(con = file("~/projects/cdk1_cyclinB1/phase_separation/disorder/disorder_UP000002311.mjson"),verbose = F)
yeastDiso$mobidb_consensus <- yeastDiso$mobidb_consensus$disorder
colnames(yeastDiso)[5] <- "disorder"

CDK1targetSacCer <- read_delim("~/projects/cdk1_cyclinB1/phase_separation/disorder/CDK1targetSacCer.csv", 
                          "\t", quote = "\\\"", escape_double = FALSE, 
                          col_types = cols(X1 = col_skip(), input = col_skip(), 
                          `yourlist:M201907046746803381A1F0E0DB47453E0216320D4B0BD1N` = col_skip()), 
                          trim_ws = TRUE)

# Now the comumn "disorder" is a unnamed list with a complex structure for each row of the data frame


spotDisorderList <- getSpotDisoMatrix("/home/gdubra/projects/cdk1_cyclinB1/phase_separation/disorder/spot_run_yeast/")


```

```{r scores ,echo=FALSE,message=FALSE,warning=FALSE, fig.cap="Supplementary Figure 6 A: Comparision of the dependance of the phosphorylation on the on the ammount of protein" }

PhosVsPL<-ggplot(scoresData,aes(x=log10(`Protein Level`),y=log10(Phosphorylation)))+geom_point(aes(color=target)) + theme_linedraw() + xlab("Log10(Protein Level<ng>)") + ylab("Log10(Phosphorylation)")
PhosVsnM<-ggplot(scoresData,aes(x=log10(`nmol`),y=log10(Phosphorylation)))+geom_point(aes(color=target)) + theme_linedraw() + theme(axis.title.y = element_blank())+ xlab("Log10(nmoles)") + ylab("Log10(Phosphorylation)")
PhosVsnEqSTP<-ggplot(scoresData,aes(x=log10(`nEq_STP`),y=log10(Phosphorylation)))+geom_point(aes(color=target)) + theme_linedraw()  + xlab("Log10(nEquivalents S/T-P)") + ylab("Log10(Phosphorylation)") 
PhosVsnEqSTPXKR<-ggplot(scoresData,aes(x=log10(`nEq_STPXKR`),y=log10(Phosphorylation)))+geom_point(aes(color=target)) + theme_linedraw() + theme(axis.title.y = element_blank()) + xlab("Log10(nEquivalents S/T-P-x-K/R)") + ylab("Log10(Phosphorylation)")

ggarrange(PhosVsPL,PhosVsnM,PhosVsnEqSTP,PhosVsnEqSTPXKR,common.legend = TRUE, legend = "bottom")
```

```{r  ,echo=FALSE,message=FALSE,warning=FALSE, fig.cap="Supplementary Figure 6 B:",fig.width=12}

ps_pm <- ggplot(scoresData,aes(y=`P-Score`,x=log10(Phosphorylation/nmol)))+geom_point(aes(color=target)) + theme_linedraw()  +  ylab("P-Score") + xlab("Log10(Phosphorylation/nMoles)")

ps_pes <- ggplot(scoresData,aes(y=`P-Score`,x=log10(Phosphorylation/nEq_STP)))+geom_point(aes(color=target)) + theme_linedraw() + theme(axis.title.y = element_blank()) +  ylab("P-Score") + xlab("Log10(Phosphorylation/nEquivalents S/T-P)")

ps_pef <- ggplot(scoresData,aes(y=`P-Score`,x=log10(Phosphorylation/nEq_STPXKR)))+geom_point(aes(color=target)) + theme_linedraw() + theme(axis.title.y = element_blank()) +  ylab("P-Score") + xlab("Log10(Phosphorylation/nEquivalents S/T-P-x-K/R)")

ggarrange(ps_pm,ps_pes,ps_pef,nrow = 1, ncol = 3,common.legend = TRUE, legend = "bottom")
```
```{r  ,echo=FALSE,message=FALSE,warning=FALSE, fig.cap="Figure 9:",fig.height=10}


# compDataSet$levelPhosphoRes<-cut(compDataSet$percPhosphoRes,breaks = c(0,0.45,1,10),labels = c("Low","Mid","High"))
# 
# ggplot(subset(CDK1targetSacCer,`P-Score`>0),aes(x=`P-Score`,y=`[ST]-P-X-[KR]`/length))+geom_point(aes(color=target))+geom_smooth(method=lm, se=FALSE)


```